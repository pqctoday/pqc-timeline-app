# Learn OpenSSL TLS 1.3 Module Requirements

**Document Version:** 1.8
**Project:** PKI Learning Module
**Technology:** OpenSSL v3.5.4 (WASM)

## 1. Overview

This module provides an interactive educational environment for understanding TLS 1.3. Users can configure a Client and a Server using both GUI controls and raw OpenSSL configuration files, then visualize the handshake process and negotiated parameters.

## 2. Functional Requirements

### 2.1 TLS Simulation

- **FR-TLS-001:** The module MUST support exclusively TLS 1.3.
- **FR-TLS-002:** The module MUST simulate a full Client-Server handshake in-memory without using network sockets.
- **FR-TLS-003:** The module MUST display a trace of the handshake events (Hello messages, Certificate exchange, Key Share, Finished).

### 2.2 Configuration

- **FR-CFG-001:** Users MUST be able to configure Cipher Suites, Supported Groups (Curves), and Signature Algorithms for both Client and Server.
- **FR-CFG-002:** **Dual Mode Configuration:**
  - **UI Mode:** Dropdown/Multiselect controls for parameters.
  - **Raw Mode:** View and Edit the underlying `openssl.cnf` text file that will be used by the OpenSSL engine.
- **FR-CFG-003:** The UI Mode MUST sync to the Raw Mode (generating valid config text).

### 2.3 Certificate Management

- **FR-CRT-001:** Users MUST be able to install certificates for the Server (Leaf + Private Key).
- **FR-CRT-002:** Users SHOULD be able to install certificates for the Client (mTLS).
- **FR-CRT-003:** Users MUST be able to install a Root CA to verify the peer's certificate.
- **FR-CRT-004:** The module MUST support importing/selecting certificates from the existing application's File Store (generated by OpenSSL Studio or other modules).
- **FR-CRT-005:** The module MUST support both Self-Signed and CA-Signed certificate chains.

### 2.4 Educational Output

- **FR-EDU-001:** The result output MUST highlight the negotiated Cipher Suite, Key Exchange Group, and Protocol Version.
- **FR-EDU-002:** The result output MUST indicate if the handshake failed and provide the specific OpenSSL error code/message.

## 3. Technical Requirements

### 3.1 OpenSSL WASM Engine

- **TR-WASM-001:** The module MUST use OpenSSL version 3.5.4.
- **TR-WASM-002:** The WASM binary MUST be custom-compiled to include a C-wrapper (`execute_tls_simulation`) that exposes internal `SSL_CTX` and `BIO` APIs to JavaScript.
- **TR-WASM-003:** The simulation MUST execute in a Web Worker to prevent UI blocking.
- **TR-WASM-004:** The OpenSSL build MUST be configured with `enable-trace` to support granular cryptographic operation logging at the provider level.
- **TR-WASM-005:** The logging buffer MUST be sufficiently large (minimally 10MB) to support verbose trace data from Post-Quantum Cryptography (PQC) keys and certificates.

### 3.2 System Architecture

- **TR-SYS-001:** The application MUST use a Virtual Filesystem (MEMFS) to share configuration files and certificates between the UI and the OpenSSL Worker.
- **TR-SYS-002:** Certificate files selected by the user must be written to the Worker's filesystem (e.g., `/ssl/server.crt`) prior to execution.

## 4. Integration

- **INT-001:** The module shall be accessible via the "PKI Learning" section (`/learn/pki/tls-basics`).
- **INT-002:** The module shall interact with the global `WorkbenchFileManager` to read user certificates.

### 2.5 TLS 1.3 Cryptographic Operations

- **FR-CRYPTO-001:** The module MUST respect and simulate the following cryptographic operations flow:

**CLIENT SIDE**
**Initial Phase:**

1. Generate ephemeral ECDHE private key → compute public key share
2. Send ClientHello with public key share

**After ServerHello:**

1. ECDHE private key + server public share → compute shared secret (ECDH)
2. Shared secret → HKDF derive handshake traffic keys
3. Handshake traffic key → decrypt Server's encrypted extensions, Certificate, CertificateVerify, Finished
4. Server public key (from cert) → verify CertificateVerify signature
5. Handshake traffic key → verify Server Finished MAC
6. Handshake traffic key + transcript hash → compute Client Finished MAC
7. Handshake traffic key → encrypt Client Finished
8. Handshake context → HKDF derive application traffic keys

**Application Phase:**

1. Application traffic keys → encrypt/decrypt application data
2. Application traffic keys → periodic key update (HKDF)

**SERVER SIDE**
**After ClientHello:**

1. Generate ephemeral ECDHE private key → compute public key share
2. ECDHE private key + client public share → compute shared secret (ECDH)
3. Shared secret → HKDF derive handshake traffic keys
4. Server private key → sign handshake transcript (CertificateVerify)
5. Handshake traffic key → encrypt extensions, Certificate, CertificateVerify
6. Handshake traffic key + transcript hash → compute Server Finished MAC
7. Handshake traffic key → encrypt Server Finished

**After Client Finished:**

1. Handshake traffic key → decrypt Client Finished
2. Handshake traffic key → verify Client Finished MAC
3. Handshake context → HKDF derive application traffic keys

**Application Phase:**

1. Application traffic keys → encrypt/decrypt application data
2. Application traffic keys → periodic key update (HKDF)

### 2.6 Cryptographic Logging

- **FR-LOG-001:** The module MUST generate a detailed cryptographic log for both the Client and the Server.
- **FR-LOG-002:** The log MUST capture granular cryptographic operations, including:
  - Key Generation (Ephemeral ECDHE keys)
  - Key Derivation (HKDF operations for Handshake and Application secrets)
  - Signatures (CertificateVerify generation and verification, including the **signature value**)
  - Encryption/Decryption steps, explicitly showing both **Clear Data (Plaintext)** and **Encrypted Data (Ciphertext)**.
- **FR-LOG-003:** The log MUST expose actual key values (e.g., public shares, private keys, shared secrets, traffic keys) and IVs where possible for educational transparency.
- **FR-LOG-004:** The logging granularity SHOULD extend to the OpenSSL Provider level, capturing calls to the underlying cryptographic implementations (e.g., `EVP_DigestSign`, `EVP_Cipher`).
- **FR-LOG-005:** The UI MUST display these cryptographic logs in a dedicated pane or tab, distinct from the high-level protocol handshake log.
- **FR-LOG-006:** The UI MUST provide independent "Protocol vs Crypto" toggles for both the Client and Server columns, allowing simultaneous viewing of different log types (e.g. Client Protocol vs Server Crypto).
- **FR-LOG-007:** The Crypto Log pane MUST include a Search feature that allows users to find specific byte sequences (Hex strings) within the logs, ignoring whitespace.
- **FR-LOG-008:** The simulation MUST be controlled by a single "Full Interaction" button that automatically executes the sequence: Handshake -> Client Message -> Server Response -> Client Disconnect -> Server Disconnect.
  - **Note:** Intermediate "Send" buttons are permitted for manual exploration if desired, but the primary educational flow is the automated Full Interaction.
- **FR-LOG-009:** The UI MUST allow users to customize the "Client Message" and "Server Response" text used in the full interaction flow.
- **FR-LOG-010:** The cryptographic logs MUST be separated into Client-side and Server-side views to clearly distinguish operations.
- **FR-LOG-011:** The UI MUST display a "Cryptographic Keys" section above the logs, showing both Static Keys (Certificates/Private Keys) and Dynamic Keys (parsed from Keylogs) for both Client and Server, to facilitate verification.

### 2.7 UI & Accessibility

- **FR-UI-001:** The module MUST use semantic color tokens for all UI elements to ensure compatibility with both Light and Dark themes.
- **FR-UI-002:** Hardcoded color values (e.g. `bg-black/40`, `text-blue-500`) are PROHIBITED for primary text and backgrounds to ensure sufficient contrast ratios.
- **FR-UI-003:** Client and Server visual elements MUST be distinctively themed (e.g. Primary vs Tertiary/Secondary colors) to maintain context.

### 2.8 PQC Algorithm Selection (OpenSSL 3.5.4)

- **FR-PQC-001:** The UI MUST allow selection of Post-Quantum Cryptography (PQC) algorithms for Key Exchange (Groups) and Signatures, limited to those supported by OpenSSL 3.5.4.
- **FR-PQC-002:** Supported PQC Key Exchange algorithms (Groups) - OpenSSL 3.5.4:
  - **ML-KEM (Kyber):** mlkem512, mlkem768, mlkem1024
  - **Hybrid ML-KEM:** X25519MLKEM768, SecP256r1MLKEM768
  - Note: HQC and other experimental KEMs require additional OQS provider integration (not in scope for v1.8)
- **FR-PQC-003:** Supported PQC Signature algorithms - OpenSSL 3.5.4:
  - **ML-DSA (Dilithium):** mldsa44, mldsa65, mldsa87
  - **SLH-DSA (SPHINCS+):** slhdsa-sha2-128s, slhdsa-sha2-128f, slhdsa-shake-128s, slhdsa-shake-128f
  - Note: Only variants with signature sizes ≤16KB are fully traceable
- **FR-PQC-004:** The UI MUST NOT offer algorithms not compiled into the OpenSSL 3.5.4 WASM build.
- **FR-PQC-005:** The trace buffer limit is 16KB per log entry. Algorithms with key/signature sizes exceeding this will have truncated trace data.
- **FR-PQC-006:** The default configuration SHOULD use classical algorithms (X25519, P-256) for maximum compatibility, with PQC options available for advanced users.
